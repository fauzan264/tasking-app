<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hello Bulma!</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  </head>
  <body>
  <section class="section is-widescreen">
    <div class="container">
			<div class="columns is-centered">
        <h1 class="title">Form</h1>
      </div>
      <div class="columns mt-4 is-centered is-6">
				<div class="column is-6">
          <form action="" method="post">
            <div class="field">
              <label for="task" class="label">Task</label>
              <div class="control">
                <input type="text" id="task" class="input" name="task" placeholder="Input task">
              </div>
            </div>
            <div class="field">
              <label for="assign" class="label">Assign</label>
              <div class="control">
                <input type="text" id="assign" class="input" name="assign" placeholder="Input assigned to">
              </div>
            </div>
            <div class="field">
              <label for="deadline" class="label">Deadline</label>
              <div class="control">
                <input type="date" id="deadline" class="input" name="deadline">
              </div>
            </div>
            <div class="field">
              <div class="control">
                <button class="button is-small is-success is-fullwidth">Submit</button>
              </div>
            </div>
          </form>
        </div>
			</div>
    </div>
  </section>
  <script>
    let urlParams = new URLSearchParams(window.location.search)

    let xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					let getData = JSON.parse(xhttp.responseText);
					let data = getData.data[0];
          document.getElementById('task').value = data.task;
          document.getElementById('assign').value = data.assign;
          let date = new Date(data.deadline);
          
          let monthDeadline = date.getMonth().toString().length < 2 ? `0${date.getMonth()+1}` : date.getMonth()+1;
          let dateDeadline = date.getDate().toString().length < 2 ? `0${date.getDate()}` : date.getDate(); 

          document.getElementById('deadline').value = [date.getFullYear(), monthDeadline, dateDeadline].join('-');

				}
			};

			xhttp.open("GET", "http://localhost:8080/api/v1/tasks?id="+urlParams.get("id"), true);
			xhttp.send();
  </script>
  </body>
</html>